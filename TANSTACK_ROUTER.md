# TanStack Router Implementation

## Overview

The application now uses **TanStack Router** for type-safe, file-based routing with automatic route generation.

## What is TanStack Router?

TanStack Router is a modern, fully type-safe router for React applications with features like:
- **File-based routing** - Routes automatically generated from file structure
- **Type-safe navigation** - Full TypeScript support with autocomplete
- **URL-based routing** - Proper browser history and deep linking
- **Code splitting** - Automatic lazy loading support
- **Search params** - Type-safe search parameter handling

## Installation

```bash
npm install @tanstack/react-router
npm install --save-dev @tanstack/router-vite-plugin
```

## Project Structure

```
src/
‚îú‚îÄ‚îÄ routes/              # Route definitions
‚îÇ   ‚îú‚îÄ‚îÄ __root.tsx      # Root layout with Header
‚îÇ   ‚îú‚îÄ‚îÄ index.tsx       # Home route (/) - redirects to /plans
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.tsx   # /dashboard route
‚îÇ   ‚îú‚îÄ‚îÄ plans.tsx       # /plans route
‚îÇ   ‚îú‚îÄ‚îÄ options.tsx     # /options route
‚îÇ   ‚îî‚îÄ‚îÄ analytics.tsx   # /analytics route
‚îú‚îÄ‚îÄ routeTree.gen.ts    # Auto-generated route tree (don't edit!)
‚îú‚îÄ‚îÄ pages/              # Page components (used by routes)
‚îÇ   ‚îú‚îÄ‚îÄ Plans.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Options.tsx
‚îú‚îÄ‚îÄ components/         # Reusable components
‚îÇ   ‚îî‚îÄ‚îÄ Header.tsx      # Updated to use Link
‚îî‚îÄ‚îÄ App.tsx            # Router provider
```

## Route Configuration

### Root Route (`src/routes/__root.tsx`)

Defines the main layout structure:

```tsx
import { createRootRoute, Outlet } from '@tanstack/react-router';
import { Header } from '../components/Header';

export const Route = createRootRoute({
  component: () => (
    <div className="min-h-screen bg-gray-50">
      <Header />
      <main className="max-w-7xl mx-auto p-8">
        <Outlet />  {/* Child routes render here */}
      </main>
    </div>
  ),
});
```

### Page Routes

Each route file exports a `Route` object:

```tsx
// src/routes/plans.tsx
import { createFileRoute } from '@tanstack/react-router';
import { Plans } from '../pages/Plans';

export const Route = createFileRoute('/plans')({
  component: Plans,
});
```

## Navigation

### Using Link Component

Replace button/onClick navigation with `<Link>` components:

```tsx
import { Link } from '@tanstack/react-router';

// Before (manual state)
<button onClick={() => setActiveItem('plans')}>Plans</button>

// After (TanStack Router)
<Link to="/plans">Plans</Link>
```

### Detecting Active Route

Use `useRouterState()` to get current route:

```tsx
import { useRouterState } from '@tanstack/react-router';

const router = useRouterState();
const currentPath = router.location.pathname;

const isActive = (path: string) => currentPath === path;
```

### Programmatic Navigation

Use `useNavigate()` hook:

```tsx
import { useNavigate } from '@tanstack/react-router';

const navigate = useNavigate();

const handleClick = () => {
  navigate({ to: '/plans' });
};
```

## Routes in the Application

| Route | File | Component | Description |
|-------|------|-----------|-------------|
| `/` | `index.tsx` | Redirect | Redirects to `/plans` |
| `/dashboard` | `dashboard.tsx` | Dashboard | Dashboard page (coming soon) |
| `/plans` | `plans.tsx` | Plans | Plans management |
| `/options` | `options.tsx` | Options | API configuration |
| `/analytics` | `analytics.tsx` | Analytics | Analytics page (coming soon) |

## Auto-Generated Route Tree

The file `src/routeTree.gen.ts` is automatically generated by the Vite plugin. 

**Important:** 
- ‚úÖ DO commit this file to git
- ‚ùå DON'T edit it manually
- üîÑ It regenerates on file changes in dev mode

## Adding New Routes

### Step 1: Create Route File

Create a new file in `src/routes/`:

```tsx
// src/routes/settings.tsx
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/settings')({
  component: Settings,
});

function Settings() {
  return (
    <div>
      <h1>Settings Page</h1>
    </div>
  );
}
```

### Step 2: Add to Navigation

Update `src/components/Header.tsx`:

```tsx
const menuItems: MenuItem[] = [
  // ... existing items
  { path: '/settings', label: 'Settings' },
];
```

### Step 3: Done!

The route tree automatically regenerates. No additional configuration needed!

## Benefits Over Manual State Routing

### Before (Manual State)

```tsx
// App.tsx
const [activeItem, setActiveItem] = useState('plans');

const renderContent = () => {
  switch (activeItem) {
    case 'plans': return <Plans />;
    case 'options': return <Options />;
    // ...
  }
};

// Header.tsx
<button onClick={() => onItemClick('plans')}>Plans</button>
```

**Issues:**
- ‚ùå No browser history
- ‚ùå No deep linking
- ‚ùå URL doesn't change
- ‚ùå Can't bookmark pages
- ‚ùå Manual state management

### After (TanStack Router)

```tsx
// App.tsx
<RouterProvider router={router} />

// Header.tsx
<Link to="/plans">Plans</Link>
```

**Benefits:**
- ‚úÖ Full browser history support
- ‚úÖ Deep linking (share `/plans` URL)
- ‚úÖ URL reflects current page
- ‚úÖ Bookmarkable pages
- ‚úÖ Type-safe navigation
- ‚úÖ Automatic code splitting
- ‚úÖ Back/forward buttons work

## Type Safety

TanStack Router provides full type safety:

```tsx
// TypeScript knows all valid routes!
<Link to="/plans" />        // ‚úÖ Valid
<Link to="/invalid" />      // ‚ùå TypeScript error

// Autocomplete works!
navigate({ to: '/' })       // Shows all available routes
```

## Search Parameters

You can add type-safe search parameters:

```tsx
// Define search params schema
import { z } from 'zod';

export const Route = createFileRoute('/plans')({
  validateSearch: z.object({
    page: z.number().optional(),
    sort: z.string().optional(),
  }),
  component: Plans,
});

// Access in component
const { page, sort } = Route.useSearch();

// Navigate with search params
<Link to="/plans" search={{ page: 2, sort: 'name' }} />
```

## Layouts and Nested Routes

Create nested layouts:

```
src/routes/
‚îú‚îÄ‚îÄ __root.tsx           # Main layout
‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îú‚îÄ‚îÄ __layout.tsx    # Dashboard layout
‚îÇ   ‚îú‚îÄ‚îÄ overview.tsx    # /dashboard/overview
‚îÇ   ‚îî‚îÄ‚îÄ stats.tsx       # /dashboard/stats
```

## Code Splitting

Routes are automatically code-split:

```tsx
// Lazy load route component
export const Route = createFileRoute('/plans')({
  component: Plans,
  // Automatically code-splits this route!
});
```

## Loader Functions

Load data before rendering:

```tsx
export const Route = createFileRoute('/plans')({
  loader: async () => {
    const plans = await fetchPlans();
    return { plans };
  },
  component: Plans,
});

// Access loaded data
const { plans } = Route.useLoaderData();
```

## Migration Notes

### What Changed

1. **App.tsx** - Simplified to just `<RouterProvider />`
2. **Header.tsx** - Uses `Link` components and `useRouterState()`
3. **Routes folder** - New folder with route definitions
4. **URL-based** - Navigation now changes URL

### Breaking Changes

- ‚ùå No more manual state (`activeItem`)
- ‚ùå No more `onItemClick` prop drilling
- ‚úÖ Use `Link` instead of buttons
- ‚úÖ Check `router.location.pathname` for active route

## Configuration

### Vite Plugin (`vite.config.ts`)

```tsx
import { TanStackRouterVite } from '@tanstack/router-vite-plugin';

export default defineConfig({
  plugins: [
    react(),
    tailwindcss(),
    TanStackRouterVite(), // Auto-generates route tree
  ],
});
```

### Router Setup (`App.tsx`)

```tsx
import { RouterProvider, createRouter } from '@tanstack/react-router';
import { routeTree } from './routeTree.gen';

const router = createRouter({ routeTree });

// Enable type checking
declare module '@tanstack/react-router' {
  interface Register {
    router: typeof router;
  }
}
```

## Testing

Navigate to:
- `http://localhost:3039/` ‚Üí Redirects to `/plans`
- `http://localhost:3039/plans` ‚Üí Plans page
- `http://localhost:3039/options` ‚Üí Options page
- `http://localhost:3039/dashboard` ‚Üí Dashboard page
- `http://localhost:3039/analytics` ‚Üí Analytics page

Test:
- ‚úÖ Browser back/forward buttons
- ‚úÖ Refreshing page maintains route
- ‚úÖ Direct URL navigation
- ‚úÖ Active nav highlighting
- ‚úÖ Bookmarking pages

## Resources

- [TanStack Router Docs](https://tanstack.com/router)
- [File-Based Routing](https://tanstack.com/router/latest/docs/framework/react/guide/file-based-routing)
- [Type Safety](https://tanstack.com/router/latest/docs/framework/react/guide/type-safety)

## Troubleshooting

### Route tree not updating?

Restart dev server:
```bash
npm run dev
```

### TypeScript errors on routes?

Ensure `routeTree.gen.ts` is generated and imported correctly.

### Link not working?

Check that `to` prop matches exact route path (case-sensitive).

